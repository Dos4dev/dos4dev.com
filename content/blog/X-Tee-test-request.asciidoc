---
title: "X-Tee test request."
date: 2021-12-11T10:00:00+01:00
draft: false
---
:source-highlighter: rouge
:rouge-style: base16.dark
:icons: font
:imagesdir: /images
ifdef::env-github[]
:imagesdir: ../../static/images
endif::[]


image::security-services-statistic.png[security-services-statistic]



I am sure you have recognized that  https://x-tee.ee/dashboard[`X-Tee`] has one more security server (SS), and yes, this is one I have launched.

I want to share with you a few moments that took me a bit of time to understand. 

I assume that you already have installed, registered SS and some data provider expose for you endpoints. This part described in the https://github.com/nordic-institute/X-Road/blob/develop/doc/Manuals/ig-ss_x-road_v6_security_server_installation_guide.md[`documentation`], 
but one moment documentation of X-Road slightly different comparing with Estonian government https://x-tee.ee/docs[`documentation`]. https://abi.ria.ee/xtee/en/turvaserveri-haldus/turvaserveri-paigaldamine[`Third documentation`], 
and the last but not least the government https://abi.ria.ee/xtee/files/en/12091395/19333123/1/1614085296736/The_data_exchange_layer_of_information_systems_regulation.pdf[`act`].
Research base on https://digikogu.taltech.ee/et/Download/dd3cc961-f8d4-453c-ae27-a17b13971292[`E-shop`]

I had two problems with before I made first test request.
 
The first, my SS didn't listen to the public 80 port. I was able to reach the application only via localhost:80. 

The second one is how to properly configure the SOAP request.
  
The first problem can be fixed easily.
Need to override https://github.com/nordic-institute/X-Road/blob/develop/doc/Manuals/ug-syspar_x-road_v6_system_parameters.md[`proxy.connector-host`] value and restart the server `systemctl restart xroad-proxy.service`.

Voila, now your SS is listening public ports and you can start to make test request:

`curl -d @request.xml --header "Content-Type: text/xml" -X POST http://my-security-server | xmlstarlet format`

Here you can see an example of request body. 
 
```
<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:id="http://x-road.eu/xsd/identifiers" xmlns:xrd="http://x-road.eu/xsd/xroad.xsd">
    <SOAP-ENV:Header>
        <xrd:client id:objectType="SUBSYSTEM">
            <id:xRoadInstance>ee-dev</id:xRoadInstance>
            <id:memberClass>COM</id:memberClass>
            <id:memberCode>1234567</id:memberCode>
            <id:subsystemCode>subSystem</id:subsystemCode>
        </xrd:client>
        <xrd:service id:objectType="SERVICE">
            <id:xRoadInstance>ee-dev</id:xRoadInstance>
            <id:memberClass>GOV</id:memberClass>
            <id:memberCode>70000310</id:memberCode>
            <id:subsystemCode>arireg</id:subsystemCode>
            <id:serviceCode>nimeSobivus_v1</id:serviceCode>
            <id:serviceVersion>v1</id:serviceVersion>
        </xrd:service>
        <xrd:userId>test</xrd:userId>
        <xrd:id>0ba036ea-d612-4e74-bf73-59a6f15627c8</xrd:id>
        <xrd:protocolVersion>4.0</xrd:protocolVersion>
    </SOAP-ENV:Header>
    <SOAP-ENV:Body>
        <test:nimeSobivus_v1 xmlns:test="http://arireg.x-road.eu/producer/">
            <test:keha>
                <test:nimi>test</test:nimi>
                <test:tapsusklass>1</test:tapsusklass>
                <test:keel>eng</test:keel>
            </test:keha>
        </test:nimeSobivus_v1>
    </SOAP-ENV:Body>
</SOAP-ENV:Envelope>
```
There you can see how X-Road community helps me to the define proper configuration of the SOAP request.  
https://jointxroad.slack.com/archives/CA66FG50T/p1635326519016400[`link to the slack conversation`] 

A couple of important moments. Yes, you can use HTTP protocol for test requests, but only for test environment.

Keep in mind, you have to use TLS connection and close public access to 80 and 443 ports. 

Additional fact about X-Tee:

Whole infrastructure has tree environment:
* Test
* Development
* Production

Test and development env are the same and for each environment you have to have separate SS.  

P.S. Happy distributed coding.
Many thanks for to the wonderful X-Road community and Estonian government auhtorities https://www.ria.ee/en.html[`RIA`] and https://www.rik.ee/en[`RIK`]. 

image::https://i.pinimg.com/originals/8c/91/af/8c91af5c569317bc6251cf8b8cfadbab.png[]
